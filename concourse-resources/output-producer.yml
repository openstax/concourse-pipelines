---
resources:
  - name: source-code
    type: git
    source:
      uri: https://github.com/openstax/output-producer-resource.git

  - name: resource-image
    type: docker-image
    source:
      repository: openstax/output-producer-resource
      username: ((docker-hub-username))
      password: ((docker-hub-password))

      jobs:
        - name: build-and-publish-image
          public: true
          plan:
            - get: source-code
              trigger: true
            - task: create-tag-file
              config:
                platform: linux
                image_resource:
                  type: docker-image
                  source: {repository: busybox}
                outputs: [{name: 'tag-file'}],
                run:
                  path: /bin/sh
                  args:
                    - -cxe
                    - |
                      echo 'dev' > tag-file/tag
            - put: resource-image
              params:
                build: source-code
                tag_file: tag-file/tag
                tag_as_latest: false
          on_success:
            put: notify
            params:
              text: ":white_check_mark: output-producer-resource docker image successfully uploaded to dockerhub."
          on_failure:
            put: notify
            params:
              text: ":warning: There was a problem building/uploading output-producer-resource docker image to dockerhub."